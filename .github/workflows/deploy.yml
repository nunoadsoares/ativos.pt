name: Deploy to Hetzner VPS

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to VPS
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USERNAME }}
          key: ${{ secrets.VPS_SSH_KEY }}
          script: |
            # Navega para a pasta principal do projeto
            cd /home/nuno/sites/ativos.pt

            # Vai buscar as 칰ltimas altera칞칫es do c칩digo
            git pull

            # Entra na pasta da aplica칞칚o e executa o Docker Compose
            # O Dockerfile agora tem toda a l칩gica necess치ria.
            cd packages/webapp && \
            echo "游냡 A reconstruir e reiniciar os contentores Docker... (Toda a l칩gica est치 agora no Dockerfile)" && \
            docker compose up --build -d --force-recreate