---
// src/pages/index.astro
import BaseLayout from '~/layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

export const prerender = true;

/* ───────────────────────────────────────────
    › Coleções
    ─────────────────────────────────────────── */
type AtivoEntry      = CollectionEntry<'ativos'>;
type PlataformaEntry = CollectionEntry<'plataformas'>;
type GuiaEntry       = CollectionEntry<'fiscais'>;

const [todosAtivos, plataformas, guiasFiscais] = await Promise.all([
  getCollection('ativos'),
  getCollection('plataformas'),
  getCollection('fiscais')
]);

/* Destaques (6 itens) */
const ativosDestaque     = todosAtivos.slice(0, 6);
const plataformasDestaque = plataformas.slice(0, 6);
const guiasFiscaisDestaque = guiasFiscais.slice(0, 4);

/* ───────────────────────────────────────────
    › Simuladores (atualizados)
    ─────────────────────────────────────────── */
const simuladores = [
  {
    slug: 'salario-liquido',
    titulo: 'Salário Líquido 2025',
    desc: 'Calcula retenção, SS e deduções mensais.',
    emoji: '💶'
  },
  {
    slug: 'englobamento-mais-valias',
    titulo: 'Englobamento de Mais-Valias',
    desc: 'Compara taxa liberatória vs englobar rendimentos.',
    emoji: '🧾'
  },
  {
    slug: 'comparador-custos',
    titulo: 'Comparador de Custos',
    desc: 'Comissões, câmbios e custódias das corretoras.',
    emoji: '💸'
  },
  {
    slug: 'mais-valias',
    titulo: 'Mais-Valias de Ações & ETFs',
    desc: 'Apura imposto a pagar, com regra FIFO e correção.',
    emoji: '📈'
  },
  {
    slug: 'yield-arrendamento',
    titulo: 'Yield de Arrendamento',
    desc: 'Compara yield bruta vs líquida e simula impostos.',
    emoji: '🏠'
  }
];

/* ─────────────────────────────────────────── */

/* FAQ JSON-LD (mantido) */
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "O que encontro no Ativos.pt?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Indicadores de mercado atualizados, simuladores fiscais e financeiros, um glossário de ativos e análises detalhadas de corretoras usadas em Portugal."
      }
    },
    {
      "@type": "Question",
      "name": "Os simuladores do Ativos.pt são gratuitos?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Sim. Todos os simuladores são gratuitos e podem ser usados sem registo."
      }
    },
    {
      "@type": "Question",
      "name": "Posso comparar corretoras no Ativos.pt?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Sim. Temos um comparador de corretoras que permite analisar taxas, regulação e custos anuais estimados de várias plataformas."
      }
    },
    {
      "@type": "Question",
      "name": "Os dados fiscais estão adaptados a Portugal?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Sim. Todo o conteúdo é focado no contexto português, incluindo tributação (IRS) e formulários relevantes."
      }
    }
  ]
};
---

<BaseLayout
  title="Ativos.pt – Investir em Portugal com Dados, Ferramentas e Guias Práticos"
  description="Indicadores de mercado, simuladores fiscais, guias passo a passo e comparador de corretoras. Menos ruído, mais decisões informadas."
>
  <Fragment slot="head">
    <script type="application/ld+json" is:inline set:html={JSON.stringify(faqSchema)} />
  </Fragment>

  <main class="bg-gray-50 dark:bg-brand-dark">

    <!-- HERO -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-14 pb-20 text-center">
      <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight text-gray-900 dark:text-white">
        Investir em Portugal, <span class="text-primary">com Dados</span>
      </h1>
      <p class="mt-6 max-w-2xl mx-auto text-lg md:text-xl text-gray-600 dark:text-gray-300">
        Indicadores chave, simuladores práticos e guias fiscais atualizados. Tome decisões com dados, não palpites.
      </p>

      <div class="mt-10 flex flex-wrap justify-center gap-4">
        <a href="/comparar" class="bg-primary text-white font-semibold py-3 px-8 rounded-full hover:opacity-90 transition">
          Comparar Corretoras
        </a>
        <a href="/simuladores" class="bg-white dark:bg-gray-800/70 border border-gray-200 dark:border-gray-700 text-gray-800 dark:text-gray-200 font-semibold py-3 px-8 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
          Ver Simuladores
        </a>
      </div>
    </section>
    
    <!-- SIMULADORES -->
    <section class="bg-white dark:bg-gray-900/40 py-16">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl sm:text-4xl font-bold text-center text-gray-900 dark:text-white mb-10">
          Simuladores & Calculadoras
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {simuladores.map((s) => (
            <a href={`/simuladores/${s.slug}`} class="block group bg-gray-50 dark:bg-gray-800/60 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-xl transition-shadow">
              <div class="text-4xl mb-4">{s.emoji}</div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
                {s.titulo}
              </h3>
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">{s.desc}</p>
              <span class="inline-block mt-4 text-primary text-sm font-semibold">Abrir →</span>
            </a>
          ))}
        </div>
      </div>
    </section>

    <!-- HUB IMOBILIÁRIO - NOVO CTA com estilo de cartão -->
    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="flex flex-col md:flex-row items-center justify-between gap-8 bg-white dark:bg-gray-900/40 border border-gray-200 dark:border-gray-700 rounded-3xl p-8 md:p-14 shadow-xl">
        <div class="flex items-center gap-6">
          <div class="flex-shrink-0 w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house text-primary"><path d="M12 22V8.3L19 3 22 5V18H15V13H9V18H2V5L5 3L12 8.3Z" /></svg>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
              O Observatório do Mercado Imobiliário
            </h2>
            <p class="text-base text-gray-600 dark:text-gray-300">
              Acompanhe dados oficiais sobre preços de habitação, custo dos créditos (TAEG/TAN) e risco de incumprimento em Portugal.
            </p>
          </div>
        </div>
        <a
          href="/imobiliario"
          class="inline-block text-center font-bold bg-primary text-white rounded-full py-3 px-8 hover:opacity-90 transition transform hover:-translate-y-1"
        >
          Ver Indicadores
        </a>
      </div>
    </section>

    <!-- GUIAS FISCAIS -->
    <section class="bg-gray-100 dark:bg-gray-800/40 py-16">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Guias Fiscais em Destaque</h2>
          <p class="mt-3 text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
            Explicações passo a passo sobre tributação de investimentos no IRS — atualizadas para 2025.
          </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-4 gap-8">
          {guiasFiscaisDestaque.map((g) => (
            <a href={`/guias-fiscais/${g.slug}`} class="group block bg-white dark:bg-gray-800/60 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6 hover:shadow-xl transition">
              <h3 class="text-lg font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
                {g.data.title}
              </h3>
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-400 line-clamp-3">{g.data.description}</p>
              <span class="inline-block mt-4 text-primary text-sm font-semibold">Ler guia →</span>
            </a>
          ))}
        </div>

        <div class="text-center mt-10">
          <a href="/guias-fiscais" class="inline-block text-primary underline font-semibold">Ver todos os guias →</a>
        </div>
      </div>
    </section>

    <!-- GLOSSÁRIO -->
    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="text-center mb-12">
        <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Glossário de Ativos</h2>
        <p class="mt-3 text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
          Entende os principais instrumentos de investimento: riscos, liquidez, prazo e tributação em Portugal.
        </p>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        {ativosDestaque.map((ativo) => (
          <a href={`/ativos/${ativo.slug}/`} class="group block bg-white dark:bg-gray-800/60 rounded-xl shadow-md hover:shadow-xl transition border border-gray-200 dark:border-gray-700 overflow-hidden">
            <div class="p-6">
              <h3 class="text-xl font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
                {ativo.data.title}
              </h3>
              {ativo.data.subtitle && (
                <p class="mt-2 text-gray-600 dark:text-gray-400 text-sm">{ativo.data.subtitle}</p>
              )}
            </div>
          </a>
        ))}
      </div>

      <div class="text-center mt-10">
        <a href="/ativos" class="inline-block text-primary underline font-semibold">Ver todos os ativos →</a>
      </div>
    </section>

    <!-- CORRETORAS -->
    <section class="bg-gray-100 dark:bg-gray-800/40 py-16">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Corretoras & Plataformas</h2>
          <p class="mt-3 text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
            Análises detalhadas de plataformas de investimento: taxas, regulação e funcionalidades.
          </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
          {plataformasDestaque.map((p) => (
            <a href={`/plataformas/${p.slug}`} class="group bg-white dark:bg-gray-800/60 rounded-xl border border-gray-200 dark:border-gray-700 p-6 shadow-md hover:shadow-xl transition">
              <img src={p.data.logo} alt={p.data.nome} class="h-10 w-10 object-contain mb-4" />
              <h3 class="text-lg font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
                {p.data.nome}
              </h3>
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">{p.data.description}</p>
              <span class="inline-block mt-4 text-primary text-sm font-semibold">Ver análise →</span>
            </a>
          ))}
        </div>

        <div class="text-center mt-10">
          <a href="/plataformas" class="inline-block text-primary underline font-semibold">Ver todas as corretoras →</a>
        </div>
      </div>
    </section>

    <!-- NEWSLETTER -->
    <section class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center">
      <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white mb-4">
        Recebe novidades e ferramentas novas
      </h2>
      <p class="text-gray-600 dark:text-gray-400 mb-8">
        Enviamos apenas conteúdo útil: novos simuladores, comparações e alertas de oportunidades.
      </p>
      <form class="flex flex-col sm:flex-row gap-3 justify-center">
        <input
          type="email"
          placeholder="O teu email"
          class="w-full sm:w-80 px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none"
          required
        />
        <button class="bg-primary text-white font-semibold py-3 px-8 rounded-xl hover:opacity-90 transition">
          Subscrever
        </button>
      </form>
      <p class="mt-3 text-xs text-gray-400">Sem spam. Podes cancelar quando quiseres.</p>
    </section>
  </main>
</BaseLayout>
