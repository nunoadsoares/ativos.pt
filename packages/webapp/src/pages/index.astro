---
import BaseLayout from '~/layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import dadosMercado from '~/data/indicadores_chave.json';

export const prerender = true;

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â€º Indicadores de Mercado
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const { indicadores = {}, data_scrape, fonte } = dadosMercado;
const listaIndicadores = Object.values(indicadores);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â€º ColeÃ§Ãµes
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
type AtivoEntry      = CollectionEntry<'ativos'>;
type PlataformaEntry = CollectionEntry<'plataformas'>;
type GuiaEntry       = CollectionEntry<'fiscais'>;

const [todosAtivos, plataformas, guiasFiscais] = await Promise.all([
  getCollection('ativos'),
  getCollection('plataformas'),
  getCollection('fiscais')
]);

/* Destaques (6 itens) */
const ativosDestaque       = todosAtivos.slice(0, 6);
const plataformasDestaque  = plataformas.slice(0, 6);
const guiasFiscaisDestaque = guiasFiscais.slice(0, 4);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â€º Simuladores (atualizados)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const simuladores = [
  {
    slug: 'salario-liquido',
    titulo: 'SalÃ¡rio LÃ­quido 2025',
    desc: 'Calcula retenÃ§Ã£o, SS e deduÃ§Ãµes mensais com as tabelas de 2025.',
    emoji: 'ğŸ’¶'
  },
  {
    slug: 'englobamento-mais-valias',
    titulo: 'Simulador de Englobamento',
    desc: 'Compara taxa liberatÃ³ria vs englobar rendimentos no IRS.',
    emoji: 'ğŸ§¾'
  },
  {
    slug: 'comparador-custos',
    titulo: 'Comparador de Custos de Corretoras',
    desc: 'ComissÃµes, cÃ¢mbios e custÃ³dias anuais das principais plataformas.',
    emoji: 'ğŸ’¸'
  },
  {
    slug: 'mais-valias',
    titulo: 'Mais-Valias de AÃ§Ãµes & ETFs',
    desc: 'Apura imposto a pagar; suporta regra FIFO e correÃ§Ã£o monetÃ¡ria.',
    emoji: 'ğŸ“ˆ'
  },
  {
    slug: 'yield-arrendamento',
    titulo: 'Yield de Arrendamento',
    desc: 'Compara yield bruta vs lÃ­quida e simula impostos.',
    emoji: 'ğŸ '
  }
];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function formatarData(dataStr: string) {
  const d = new Date(dataStr);
  d.setDate(d.getDate() + 1);
  return d.toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' });
}
const scrapeHuman = new Date(data_scrape).toLocaleString('pt-PT');

/* FAQ JSON-LD (mantido) */
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "O que encontro no Ativos.pt?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Indicadores de mercado atualizados, simuladores fiscais e financeiros, um glossÃ¡rio de ativos e anÃ¡lises detalhadas de corretoras usadas em Portugal."
      }
    },
    {
      "@type": "Question",
      "name": "Os simuladores do Ativos.pt sÃ£o gratuitos?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Sim. Todos os simuladores sÃ£o gratuitos e podem ser usados sem registo."
      }
    },
    {
      "@type": "Question",
      "name": "Posso comparar corretoras no Ativos.pt?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Sim. Temos um comparador de corretoras que permite analisar taxas, regulaÃ§Ã£o e custos anuais estimados de vÃ¡rias plataformas."
      }
    },
    {
      "@type": "Question",
      "name": "Os dados fiscais estÃ£o adaptados a Portugal?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Sim. Todo o conteÃºdo Ã© focado no contexto portuguÃªs, incluindo tributaÃ§Ã£o (IRS) e formulÃ¡rios relevantes."
      }
    }
  ]
};
---

<BaseLayout
  title="Ativos.pt â€“ Investir em Portugal com Dados, Ferramentas e Guias PrÃ¡ticos"
  description="Indicadores de mercado, simuladores fiscais, guias passo a passo e comparador de corretoras. Menos ruÃ­do, mais decisÃµes informadas."
>
  <Fragment slot="head">
    <script type="application/ld+json" is:inline set:html={JSON.stringify(faqSchema)} />
  </Fragment>

  <main class="bg-gray-50 dark:bg-brand-dark">

    <!-- HERO -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-14 pb-20 text-center">
      <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight text-gray-900 dark:text-white">
        Investir em Portugal, <span class="text-primary">sem suposiÃ§Ãµes</span>
      </h1>
      <p class="mt-6 max-w-2xl mx-auto text-lg md:text-xl text-gray-600 dark:text-gray-300">
        Indicadores chave, simuladores prÃ¡ticos e guias fiscais atualizados. Tome decisÃµes com dados, nÃ£o palpites.
      </p>

      <div class="mt-10 flex flex-wrap justify-center gap-4">
        <a href="/comparar" class="bg-primary text-white font-semibold py-3 px-8 rounded-full hover:opacity-90 transition">
          Comparar Corretoras
        </a>
        <a href="/simuladores" class="bg-white dark:bg-gray-800/70 border border-gray-200 dark:border-gray-700 text-gray-800 dark:text-gray-200 font-semibold py-3 px-8 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
          Ver Simuladores
        </a>
      </div>
    </section>

    <!-- INDICADORES -->
    {listaIndicadores.length > 0 && (
      <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
        <h2 class="text-3xl sm:text-4xl font-bold text-center text-gray-900 dark:text-white mb-10">
          Indicadores chave do mercado
        </h2>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {listaIndicadores.map((ind: any) => (
            <div class="bg-white dark:bg-gray-800/60 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 text-center flex flex-col justify-between">
              <div>
                <p class="text-sm font-semibold text-gray-600 dark:text-gray-300 h-10">{ind.label}</p>
                <div class="flex items-baseline justify-center gap-x-1 mt-3">
                  <span class="text-4xl font-extrabold text-gray-900 dark:text-white">{ind.valor}</span>
                  <span class="text-lg font-medium text-gray-500 dark:text-gray-400">{ind.unidade}</span>
                </div>
              </div>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-3">
                ({formatarData(ind.data_referencia)})
              </p>
            </div>
          ))}
        </div>

        <p class="text-center text-xs text-gray-400 dark:text-gray-500 mt-4">
          Fonte: {fonte} Â· Ãšltima atualizaÃ§Ã£o: {scrapeHuman}
        </p>
      </section>
    )}

    <!-- SIMULADORES -->
    <section class="bg-white dark:bg-gray-900/40 py-16">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl sm:text-4xl font-bold text-center text-gray-900 dark:text-white mb-10">
          Simuladores & Calculadoras
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {simuladores.map((s) => (
            <a href={`/simuladores/${s.slug}`} class="block group bg-gray-50 dark:bg-gray-800/60 rounded-xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-xl transition-shadow">
              <div class="text-4xl mb-4">{s.emoji}</div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
                {s.titulo}
              </h3>
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">{s.desc}</p>
              <span class="inline-block mt-4 text-primary text-sm font-semibold">Abrir â†’</span>
            </a>
          ))}
        </div>
      </div>
    </section>

    <!-- CTA COMPARADOR DE CUSTOS -->
    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="bg-gradient-to-r from-primary to-secondary rounded-3xl p-10 md:p-14 text-center shadow-xl text-white">
        <h2 class="text-3xl md:text-4xl font-extrabold mb-4">
          Qual Ã© a corretora mais barata para ti?
        </h2>
        <p class="max-w-2xl mx-auto text-base md:text-lg opacity-90 mb-8">
          Compara, em segundos, comissÃµes, cÃ¢mbios e custos de custÃ³dia das principais plataformas usadas em Portugal.
        </p>
        <a
          href="/simuladores/comparador-custos"
          class="inline-flex justify-center items-center font-bold bg-white text-primary rounded-full py-3 px-8 w-full max-w-xs sm:w-auto mx-auto hover:opacity-90 transition"
        >
          Abrir Comparador de Custos
        </a>
      </div>
    </section>

    <!-- GUIAS FISCAIS -->
    <section class="bg-gray-100 dark:bg-gray-800/40 py-16">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Guias Fiscais em Destaque</h2>
          <p class="mt-3 text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
            ExplicaÃ§Ãµes passo a passo sobre tributaÃ§Ã£o de investimentos no IRS â€” atualizadas para 2025.
          </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-4 gap-8">
          {guiasFiscaisDestaque.map((g) => (
            <a href={`/guias-fiscais/${g.slug}`} class="group block bg-white dark:bg-gray-800/60 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6 hover:shadow-xl transition">
              <h3 class="text-lg font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
                {g.data.title}
              </h3>
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-400 line-clamp-3">{g.data.description}</p>
              <span class="inline-block mt-4 text-primary text-sm font-semibold">Ler guia â†’</span>
            </a>
          ))}
        </div>

        <div class="text-center mt-10">
          <a href="/guias-fiscais" class="inline-block text-primary underline font-semibold">Ver todos os guias â†’</a>
        </div>
      </div>
    </section>

    <!-- GLOSSÃRIO -->
    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="text-center mb-12">
        <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">GlossÃ¡rio de Ativos</h2>
        <p class="mt-3 text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
          Entende os principais instrumentos de investimento: riscos, liquidez, prazo e tributaÃ§Ã£o em Portugal.
        </p>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        {ativosDestaque.map((ativo) => (
          <a href={`/ativos/${ativo.slug}/`} class="group block bg-white dark:bg-gray-800/60 rounded-xl shadow-md hover:shadow-xl transition border border-gray-200 dark:border-gray-700 overflow-hidden">
            <div class="p-6">
              <h3 class="text-xl font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
                {ativo.data.title}
              </h3>
              {ativo.data.subtitle && (
                <p class="mt-2 text-gray-600 dark:text-gray-400 text-sm">{ativo.data.subtitle}</p>
              )}
            </div>
          </a>
        ))}
      </div>

      <div class="text-center mt-10">
        <a href="/ativos" class="inline-block text-primary underline font-semibold">Ver todos os ativos â†’</a>
      </div>
    </section>

    <!-- CORRETORAS -->
    <section class="bg-gray-100 dark:bg-gray-800/40 py-16">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Corretoras & Plataformas</h2>
          <p class="mt-3 text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
            AnÃ¡lises detalhadas de plataformas de investimento: taxas, regulaÃ§Ã£o e funcionalidades.
          </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
          {plataformasDestaque.map((p) => (
            <a href={`/plataformas/${p.slug}`} class="group bg-white dark:bg-gray-800/60 rounded-xl border border-gray-200 dark:border-gray-700 p-6 shadow-md hover:shadow-xl transition">
              <img src={p.data.logo} alt={p.data.nome} class="h-10 w-10 object-contain mb-4" />
              <h3 class="text-lg font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors">
                {p.data.nome}
              </h3>
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">{p.data.description}</p>
              <span class="inline-block mt-4 text-primary text-sm font-semibold">Ver anÃ¡lise â†’</span>
            </a>
          ))}
        </div>

        <div class="text-center mt-10">
          <a href="/plataformas" class="inline-block text-primary underline font-semibold">Ver todas as corretoras â†’</a>
        </div>
      </div>
    </section>

    <!-- NEWSLETTER -->
    <section class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center">
      <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white mb-4">
        Recebe novidades e ferramentas novas
      </h2>
      <p class="text-gray-600 dark:text-gray-400 mb-8">
        Enviamos apenas conteÃºdo Ãºtil: novos simuladores, comparaÃ§Ãµes e alertas de oportunidades.
      </p>
      <form class="flex flex-col sm:flex-row gap-3 justify-center">
        <input
          type="email"
          placeholder="O teu email"
          class="w-full sm:w-80 px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none"
          required
        />
        <button class="bg-primary text-white font-semibold py-3 px-8 rounded-xl hover:opacity-90 transition">
          Subscrever
        </button>
      </form>
      <p class="mt-3 text-xs text-gray-400">Sem spam. Podes cancelar quando quiseres.</p>
    </section>
  </main>
</BaseLayout>
