# Configuração para o servidor Nginx
server {
  # O servidor vai "ouvir" na porta 80, a porta padrão para HTTP
  listen 80;
  listen [::]:80;

  # O nome do servidor (pode ser o teu domínio ou o IP)
  server_name ativos.pt www.ativos.pt;

  # A localização dos ficheiros do nosso site dentro do contentor Docker
  root /usr/share/nginx/html;
  index index.html;

  # --- INÍCIO DO CÓDIGO ADICIONADO ---
  # Redirecionamento 301 para passar o valor de SEO das páginas antigas "/comparar/"
  # para a nova estrutura "/plataformas/comparar/".
  location ~ ^/comparar/(.*)$ {
      return 301 https://$host/plataformas/comparar/$1;
  }
  # --- FIM DO CÓDIGO ADICIONADO ---

  location / {
    # Tenta encontrar um ficheiro com o nome exato do pedido.
    # Se não encontrar, tenta encontrar uma pasta com esse nome.
    # Se falhar, devolve o ficheiro /index.html (importante para o routing do Astro).
    try_files $uri $uri/ /index.html;
  }

  # Otimizações para performance e segurança
  sendfile on;
  tcp_nopush on;
  tcp_nodelay on;
  keepalive_timeout 65;
  types_hash_max_size 2048;
  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  # Configurações de Gzip para comprimir os ficheiros e acelerar o site
  gzip on;
  gzip_disable "msie6";
  gzip_vary on;
  gzip_proxied any;
  gzip_comp_level 6;
  gzip_buffers 16 8k;
  gzip_http_version 1.1;
  gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}