---
/*  src/pages/guias-fiscais/index.astro  */
import BaseLayout from '~/layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

type GuiaEntry = CollectionEntry<'fiscais'>;

const todosGuias: GuiaEntry[] = (await getCollection('fiscais')).sort(
  (a, b) => b.data.updatedDate.valueOf() - a.data.updatedDate.valueOf()
);

// Agrupa por categoria
const guiasAgrupados: Record<string, GuiaEntry[]> = {};
todosGuias.forEach((guia) => {
  const cat = guia.data.category.trim().replace(/\s+/g, ' ');
  if (!guiasAgrupados[cat]) guiasAgrupados[cat] = [];
  guiasAgrupados[cat].push(guia);
});

// Ordem das categorias (alfabética ou manual)
// const categoriasOrdenadas = ['Criptoativos', 'Dividendos', 'IRS'].filter(c => guiasAgrupados[c]);
const categoriasOrdenadas = Object.keys(guiasAgrupados).sort();

// Schema JSON-LD
const itemListSchema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  name: "Guias Fiscais para Investidores em Portugal",
  description:
    "Artigos e guias práticos sobre como declarar os seus investimentos no IRS, otimizar a sua carga fiscal e cumprir as suas obrigações.",
  itemListElement: todosGuias.map((guia, i) => ({
    "@type": "ListItem",
    position: i + 1,
    item: {
      "@type": "Article",
      name: guia.data.title,
      url: new URL(`/guias-fiscais/${guia.slug}/`, Astro.site).href,
    },
  })),
};
---

<BaseLayout
  title="Guias Fiscais para Investidores"
  description="Artigos e guias práticos sobre como declarar os seus investimentos no IRS, otimizar a sua carga fiscal e cumprir as suas obrigações."
>
  <Fragment slot="head">
    <script type="application/ld+json" is:inline>
      {JSON.stringify(itemListSchema)}
    </script>
  </Fragment>

  <main class="bg-gray-50 dark:bg-gray-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
      <!-- Título da página -->
      <div class="text-center mb-16">
        <h1
          class="text-4xl md:text-5xl font-extrabold text-gray-900 dark:text-white tracking-tight"
        >
          Guias Fiscais
        </h1>
        <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600 dark:text-gray-300">
          Tudo o que precisa de saber para tratar da fiscalidade dos seus
          investimentos sem dores de cabeça.
        </p>
      </div>

      <div class="space-y-24">
        {categoriasOrdenadas.map((categoria) => (
          <section class="max-w-3xl mx-auto">
            <h2
              class="text-2xl font-bold text-primary border-b-2 border-primary/20 pb-2 mb-6 text-center"
            >
              {categoria}
            </h2>

            <div class="space-y-6">
              {guiasAgrupados[categoria].map((guia) => (
                <a
                  href={`/guias-fiscais/${guia.slug}/`}
                  class="group block bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-xl transition-all duration-300 ease-in-out border border-gray-200 dark:border-gray-700 p-6"
                >
                  <div
                    class="flex flex-col items-center sm:flex-row sm:items-start gap-6"
                  >
                    <div class="flex-shrink-0">
                      <div
                        class="h-12 w-12 rounded-lg bg-primary/10 flex items-center justify-center border border-primary/20"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-6 w-6 text-primary"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                          />
                        </svg>
                      </div>
                    </div>

                    <div class="flex-1 text-center sm:text-left">
                      <h3
                        class="text-xl font-bold text-gray-900 dark:text-white group-hover:text-primary transition-colors"
                      >
                        {guia.data.title}
                      </h3>
                      <p class="mt-2 text-gray-600 dark:text-gray-400 text-sm">
                        {guia.data.description}
                      </p>
                    </div>
                  </div>
                </a>
              ))}
            </div>
          </section>
        ))}
      </div>
    </div>
  </main>
</BaseLayout>
