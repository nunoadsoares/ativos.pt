---
import Navbar        from '~/components/Navbar.astro';
import Footer        from '~/components/Footer.astro';
import BreadcrumbLD  from '~/components/BreadcrumbLD.astro';
import '~/styles/global.css';

/* ── Props ─────────────────────────────────── */
export interface Props {
  title:        string;
  description:  string;
  canonical?:   string;
  breadcrumbs?: { name: string; url: string }[];
}

const { title, description, canonical, breadcrumbs } = Astro.props;
const canonicalURL = canonical ?? new URL(Astro.url.pathname, Astro.site!).href;

/* ── Breadcrumb helper ─────────────────────── */
function gerarCrumbsFromUrl(path: string) {
  const parts  = path.split('/').filter(Boolean);

  /* Tipado como Record<string,string> para evitar o erro 7053 */
  const labels: Record<string, string> = {
    'guias-fiscais': 'Guias Fiscais',
    'simuladores':   'Simuladores',
    'ativos':        'Ativos',
    'plataformas':   'Corretoras'
  };

  let seg = '';
  const trail = parts.map((p) => {
    seg += `/${p}`;
    return {
      name: labels[p] ?? p
        .replace(/-/g, ' ')
        .replace(/\b\w/g, (l) => l.toUpperCase()),
      url:  `${Astro.site}${seg}/`
    };
  });

  return [{ name: 'Início', url: Astro.site }, ...trail];
}

const crumbs = breadcrumbs ?? gerarCrumbsFromUrl(Astro.url.pathname);
---
<!DOCTYPE html>
<html lang="pt-PT" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <meta name="generator" content={Astro.generator} />

  <title>{title} | Ativos.pt</title>
  <meta name="description" content={description} />
  <link rel="canonical" href={canonicalURL} />

  <meta property="og:type"        content="website" />
  <meta property="og:url"         content={canonicalURL} />
  <meta property="og:title"       content={`${title} | Ativos.pt`} />
  <meta property="og:description" content={description} />

  <slot name="head" />

  <!-- Breadcrumb JSON-LD -->
  <BreadcrumbLD breadcrumbs={crumbs} />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <style is:global>body{font-family:'Inter',sans-serif}</style>

  <script is:inline>
    (()=>{const t=localStorage.getItem('theme');t==='dark'&&document.documentElement.classList.add('dark')})();
  </script>
</head>
<body class="bg-white dark:bg-brand-dark text-gray-800 dark:text-gray-200 antialiased">
  <Navbar/>
  <main class="flex-grow">
    <slot/>
  </main>
  <Footer/>
</body>
</html>
